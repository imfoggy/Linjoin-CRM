<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{$_siteName}</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="shortcut icon" href="/favicon.ico">
    <link type="text/css" href="__OTHER__/xitong/jquery-ui-1.10.0.custom.css" rel="stylesheet">
    <link type="text/css" href="__OTHER__/xitong/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="__OTHER__/xitong/bootstrap.min.css" rel="stylesheet">
    <link href="__OTHER__/xitong/font-awesome.css" rel="stylesheet">
    <link href="__OTHER__/xitong/font-awesome.min.css" rel="stylesheet">
    <link type="text/css" href="__OTHER__/xitong/hovershow.css" rel="stylesheet">
    <!-- animate -->
    <link rel="stylesheet" href="__OTHER__/xitong/animate.min.css">
    <link rel="stylesheet" href="__OTHER__/xitong/notification.css">

    <!-- Toastr style -->
    <link href="__OTHER__/xitong/toastr.min.css" rel="stylesheet">
    <!-- Sweet Alert -->
    <link href="__OTHER__/xitong/sweetalert.css" rel="stylesheet">
    <link href="__OTHER__/xitong/style.css" rel="stylesheet">
    <link href="__OTHER__/xitong/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <!-- Mainly scripts -->
    <script src="__OTHER__/xitong/jquery-2.1.1.js"></script>
    <script src="__OTHER__/xitong/bootstrap.min.js"></script>
    <script src="__OTHER__/xitong/moment.min.js"></script>
    <script src="__OTHER__/xitong/jquery.form.js" type="text/javascript"></script>
    <script src="__OTHER__/xitong/jquery.metisMenu.js"></script>
    <script src="__OTHER__/xitong/jquery.slimscroll.min.js"></script>
    <!-- Toastr -->
    <script src="__OTHER__/xitong/toastr.min.js"></script>

    <!-- Sweet alert -->
    <script src="__OTHER__/xitong/sweetalert.min.js"></script>
    <link href="__JS__/plugins/layui/css/layui.css" rel="stylesheet">
    <style>
        .nav.nav-tabs-left li{width:100%;}
        .nav-tabs-left>li.active>a{border-top:white;color: #19aa8d !important;background-color:#fff;}
        .table>tbody>tr>td{border-top:0px;}
        .table>tfoot>tr>td{border-top:0px;}
        #main_pic_prev{width: 38px;height: 38px;border: 1px dashed #d3d3d6;}
        .table tbody tr {cursor: Default;}
    </style>
    <style>
        body{
          overflow-y: hidden;
        }
        table tbody tr{cursor:move;}
        .active {color: #000;}
        .nav.nav-tabs-left li{width:100%;}
        .nav-tabs-left>li.active>a{border-top:white;color: #19aa8d !important;background-color:#fff;}
        
        /*主要样式*/
        .subNavBox{width:100%;margin-top:0px;margin-bottom:50px;}
        .subNav{
          cursor:pointer;
          font-size:14px;
          color:#000;
          line-height:40px;
          padding-left:10px;
        }
        .subNav_text{
          cursor:pointer;
          font-size:14px;
          color:#000;
          line-height:40px;
          padding-left:10px;
        }
        subNavBox ul{margin-bottom:18px;}
        .subNav:hover{color:#375264;}
        /*.currentDt{background-image:url(./App/C2.5.1/Public/img/jiantou.jpg);}*/
        .navContent{list-style: none;display: none;padding-left: 13px;}
        .navContent li a{display:block;width:100%;height:32px;text-align:left;font-size:14px;line-height:32px;color:#000;}
        .li_text{padding-left:10px;width: 100%;float:left;line-height:32px;margin-bottom:3px;}
        .li_text:hover{background-color:#f5f5f5;}
        .li_text_active{float:left;background-color:#f5f5f5;padding-left:10px;width: 100%;border-left:2px solid #03a9f4;line-height:32px;margin-bottom:3px;color:#03a9f4;}
        #table_div>table a{color: unset;}
        #tfoot_div{text-align: center;}
        .hr-line-dashed{margin:10px 0px;}
/*        .version:first-child{margin-left: -10px;}*/
    </style>
    <link href="__OTHER__/xitong/cropper.min.css" rel="stylesheet">
    <script src="__OTHER__/xitong/cropper.min.js"></script>
    <script type="text/javascript">
        $(function(){
            $("#left_height").height(window.innerHeight-$("#left_height").offset().top-32);
            $(window).resize(function(){
                $("#left_height").height(window.innerHeight-$("#left_height").offset().top-32);
            });
        })
    </script>
</head>

<body class="gray-bg">
    <div id="wrapper">
        <div id="page-wrapper" class="gray-bg" style="background: rgb(230, 233, 240); min-height: 889px;margin: 0px 0px 0px 0px;">
            <div class="wrapper wrapper-content animated fadeIn">
                <div class="row">
                    <div class="col-sm-12">         
                        {include file="public:middle" /}
                        <div class="col-sm-10">
                            <div id="table_container" style="border-top:3px solid #e7eaec;">
                                <div class="title-bar">
                                    <div class="row " id="title-show">
                                        <div class="nav pull-left" style="margin:2px 0 0 15px;">
                                            <a data-toggle="modal" onclick="userForm(this);" class="btn btn-primary btn-sm pull-left" style="margin-right:8px"><i class="fa fa-plus-circle"></i>&nbsp; 添加账号</a>                            
                                        </div>
                                        <form class="form-inline" action="{:url('superman/index')}" method="post">
                                            <ul class="breadcrum pull-right" style="margin-bottom: 0px">
                                                <li>
                                                    搜索：
                                                    <div class="input-group">
                                                        <input id="short_search" type="text" style="width:160px;" placeholder="请输入公司名称" onkeydown="if(event.keyCode==13) {$('#short_search_btn').trigger('click');return false;}" class="form-control input-sm" name="search_company" value="{$search_company|default=''}">
                                                        <span class="input-group-btn">
                                                            <button class="btn btn-default btn-search" id="short_search_btn" type="submit"><i class="fa fa-search"></i></button>
                                                        </span>
                                                    </div>
                                                </li>
                                            </ul>
                                        </form>
                                    </div>
                                </div>
                                <form action="" id="user_form" method="post" style="position:relative;">
                                    <div class="col-sm-12 ibox-content" style="margin-top:0px;padding:0px;">
                                        <div id="table_div" class="nicescroll" style="left: 0px; top: 0px; height: 687px; overflow: auto; outline: none;" tabindex="0">
                                            <table class="table table-hover table-striped table_thead_fixed" id="tab_Test3">
                                                <tbody>
                                                    <tr colspan="7" class="tabTh">
                                                        <td nowrap="nowrap">ID</td>
                                                        <td nowrap="nowrap">公司</td>
                                                        <td nowrap="nowrap">登录账号</td>
                                                        <td nowrap="nowrap">登陆密码</td>
                                                        <td nowrap="nowrap">手机号</td>
                                                        <td nowrap="nowrap">邮箱</td>                             
                                                        <!-- <td nowrap="nowrap">QQ</td>
                                                        <td nowrap="nowrap">微信</td> -->
                                                        <td nowrap="nowrap">开始时间</td>
                                                        <td nowrap="nowrap">到期时间</td>
                                                        <td nowrap="nowrap">剩余天数</td>
                                                        <td nowrap="nowrap">操作</td>
                                                    </tr>
                                                    {volist name="lists" id="vo"}
                                                    <tr>
                                                        <td nowrap="nowrap">{$vo.id}</td>
                                                        <td nowrap="nowrap">{$vo.company}</td>
                                                        <td nowrap="nowrap">
                                                            <span class="fa fa-circle" style="color:{eq name='vo.is_ban' value='0'}#5ACD61;{else/}#FF6C62;{/eq}"></span> 
                                                            {$vo.username}</td>
                                                        <td nowrap="nowrap">{$vo.password}</td>
                                                        <td nowrap="nowrap">{$vo.phone}</td>
                                                        <td nowrap="nowrap">{$vo.email}</td>
                                                        <!-- <td nowrap="nowrap">{$vo.qq}</td>
                                                        <td nowrap="nowrap">{$vo.wechat}</td> -->
                                                        <td nowrap="nowrap">{$vo.start_time}</td>
                                                        <td nowrap="nowrap">{$vo.end_time}</td>
                                                        <td nowrap="nowrap" style="color:red">{$vo.diffDays} 天</td>
                                                        <td>
                                                            <div class="btn-group">
                                                                <button data-toggle="dropdown" class="btn btn-primary dropdown-toggle">操作 <span class="caret"></span>
                                                                </button>
                                                                <ul class="dropdown-menu">
                                                                    <li><a href="javascript:void(0)" data-toggle="modal" onclick="userForm({$vo.id},'edit');">编辑用户</a>
                                                                    </li>
                                                                    {eq name="vo.is_ban" value="0"}
                                                                    <li><a href="javascript:void(0)" onclick="banUser({$vo.id});">停用账号</a>
                                                                    </li>
                                                                    {else /}
                                                                    <li><a href="javascript:void(0)" onclick="activeUser({$vo.id});">启用账号</a>
                                                                    </li>
                                                                    {/eq}
                                                                    <!-- <li><a href="javascript:void(0)" data-toggle="modal" onclick="showLogForm({$vo.id});">修改密码</a>
                                                                    </li> -->
                                                                </ul>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    {/volist}                              
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="ibox-content" style="position:relative;padding-top: 5px;height: 40px;border: none;">
                                            <div class="table-content">
                                                <div class="ibox-span">
                                                    <span class="fa fa-circle" style="color:#5ACD61;"></span>
                                                    <span>已启用</span>
                                                </div>
                                                <div class="ibox-span">
                                                    <span class="fa fa-circle" style="color:#FF6C62;"></span>
                                                    <span>已停用</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="tfoot_div" class="clearfix">
                                            {$lists|raw}
                                        </div>
                                    </div>
                                </form>                     
                            </div>                      
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加用户弹出层 -->
    <div id="modal-user" class="modal fade" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">开通账号</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-12">
                            <form class="form-horizontal ajax-form layui-form" method="post" action="{:url('superman/save')}" id="user-form">

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">公司名称</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" name="company" id="company" autocomplete="off" required>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">管理员账号</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" name="username" id="username" autocomplete="off" required>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">管理员密码</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" name="password" id="password" autocomplete="off" required>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">手机</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" name="phone" id="phone" autocomplete="off" required>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>

                                <!-- <div class="form-group">
                                    <label class="col-sm-2 control-label">QQ</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" name="qq" id="qq" autocomplete="off">
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">微信</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" name="wechat" id="wechat" autocomplete="off">
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div> -->

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">邮箱</label>
                                    <div class="col-sm-10">
                                        <input type="email" class="form-control" name="email" id="email" autocomplete="off" required>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">开始时间</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" name="start_time" id="start_time" onclick="WdatePicker({dateFmt:'yyyy-MM-dd',alwaysUseStartDate:true});" autocomplete="off" required>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">到期时间</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" name="end_time" id="end_time" onclick="WdatePicker({dateFmt:'yyyy-MM-dd',alwaysUseStartDate:true});" autocomplete="off" required>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">状态</label>
                                    <div class="col-md-6" style="width: 60%">　
                                        <div class="radio radio-info radio-inline">
                                            <input type="radio" name="is_ban" value="0" checked="checked" lay-ignore>
                                            <label for="has_sn1">启用</label></div>
                                        <div class="radio radio-info radio-inline">
                                            <input type="radio" name="is_ban" value="1" lay-ignore>
                                            <label for="has_sn2" style="margin-right: 15px;">禁用</label></div>
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label">版本</label>
                                    <div class="col-md-10">　
                                        {volist name="versions" id="vo"}
                                        <div class="radio radio-info radio-inline version" title="{$vo.desc}">
                                            <input type="radio" name="version_id" title="{$vo.desc}" value="{$vo.id}" {eq name="vo.id" value="1"}checked="checked"{/eq} lay-ignore required="required">
                                            <label for="has_sn1">{$vo.name}</label>
                                        </div>
                                        {/volist}
                                    </div>
                                </div>
                                <div class="hr-line-dashed"></div>

                                <div class="form-group">
                                    <div class="col-sm-12 col-sm-offset-9">
                                        <button class="btn btn-primary" type="submit" lay-submit>确认信息</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="__OTHER__/xitong/index.js"></script> 
    <!-- layer --> 
    <script src="__JS__/plugins/layui/layui.all.js"></script>
    <script src="__JS__/layuiformSelects-v3.js"></script>
    <script src="__JS__/plugins/layui/ajax-form.js"></script>
    <!-- 时间选择控件 -->
    <script src="__JS__/plugins/My97DatePicker/WdatePicker.js"></script>
    <script type="text/javascript">
    　　　 $(function(){
    　　　　    $("#inner-content").slimScroll({ height: '815px' });
    　　　　})

    	//停用账号
    	function banUser(x){
    		var id = x;
    		if(!id){
                swal('操作失败', '请选择一条数据', 'error');
                return false;
            }
            swal(
                {title:"您确定要停用此账号吗",
                text:"账号停用后，将无法登陆并且无法进行任何操作",
                type:"warning",
                showCancelButton:true,
                confirmButtonColor:"#DD6B55",
                confirmButtonText:"是的，确认停用！",
                cancelButtonText:"取消",
                closeOnConfirm:false,
                },
                function(isConfirm)
                {
                    if(isConfirm)
                    {
                       $.ajax({
                            type:'post',
                            url:"{:url('superman/ban')}",
                            data:{id: id},
                            beforeSend:function(){
                                before = layer.msg('正在处理，请稍后...',{time:0,icon:4,shade:0.5});
                            },
                            success:function(d){
                                if(d.code == 1){
                                    swal({title:'提示', text:d.msg,type:'success'},function(){
                                        window.location.reload();
                                    })
                                }else{
                                    swal('提示',d.msg,'error');
                                }
                            },
                            complete:function(){
                                layer.close(before);
                            },
                            error:function(){
                                layer.msg('网络错误',{shade:0.7});
                            }
                       })
                    }
                }
            )
    	}

        //启用账号
        function activeUser(x){
            var id = x;
            if(!id){
                swal('操作失败', '请选择一条数据', 'error');
                return false;
            }
            swal(
                {title:"您确定要启用此账号吗",
                text:"",
                type:"warning",
                showCancelButton:true,
                confirmButtonColor:"#DD6B55",
                confirmButtonText:"是的，确认启用！",
                cancelButtonText:"取消",
                closeOnConfirm:false,
                },
                function(isConfirm)
                {
                    if(isConfirm)
                    {
                       $.ajax({
                            type:'post',
                            url:"{:url('superman/active')}",
                            data:{id: id},
                            beforeSend:function(){
                                before = layer.msg('正在处理，请稍后...',{time:0,icon:4,shade:0.5});
                            },
                            success:function(d){
                                if(d.code == 1){
                                    swal({title:'提示', text:d.msg,type:'success'},function(){
                                        window.location.reload();
                                    })
                                }else{
                                    swal('提示',d.msg,'error');
                                }
                            },
                            complete:function(){
                                layer.close(before);
                            },
                            error:function(){
                                layer.msg('网络错误',{shade:0.7});
                            }
                       })
                    }
                }
            )
        }

        /**
         * 编辑用户
         * @Author Foggy
         * @Date   2018-11-14
         * @WeChat [vita_hacker]
         * @Email  [x_foggy@163.com]
         * @return {[type]}          [description]
         */
        function userForm(x,action){
            if(action == 'edit'){
                if(!x){
                    layer.msg('用户id参数缺失',{time:1200,shade:0.7});
                    return false;
                }

                $.ajax({
                    type:'post',
                    url:"{:url('superman/edit')}",
                    data:{id: x},
                    beforeSend:function(){
                        before = layer.msg('正在处理，请稍后...',{time:0,icon:4,shade:0.5});
                    },
                    success:function(d){
                        if(d.code == 1){
                            $("#company").val(d.data.company);
                            $("#username").attr("disabled", true);
                            $("#username").attr("readonly", true);
                            $("#username").removeAttr("name");
                            $("#username").val(d.data.username);
                            $("#phone").val(d.data.phone);
                            //$("#password").val(d.data.password);
                            $("#password").removeAttr("required");
                            $("#password").attr("placeholder","若不修改，请留空");
                            $("#email").val(d.data.email);
                            // $("#qq").val(d.data.qq);
                            // $("#wechat").val(d.data.wechat);
                            $("#start_time").val(d.data.start_time);
                            $("#end_time").val(d.data.end_time);
                            $("#is_ban").val(d.data.is_ban);
                            $("input[name='version_id'][value='"+d.data.version_id+"']").prop('checked', "checked");
                            $("#user-form").attr("action","{:url('superman/update')}?id="+x);
                            $("#modal-user").modal();
                        }else{
                            swal('提示',d.msg,'error');
                        }
                    },
                    complete:function(){
                        layer.close(before);
                    },
                    error:function(){
                        layer.msg('网络错误',{shade:0.7});
                    }
               })
            }else{
                $("#company").val('');
                $("#username").val('');
                $("#phone").val('');
                $("#username").removeAttr("disabled");
                $("#username").removeAttr("readonly");
                $("#username").attr("name", "username");
                $("#password").val('');
                $("#password").attr("required","required");
                $("#password").removeAttr("placeholder");
                $("#email").val('');
                // $("#qq").val('');
                // $("#wechat").val('');
                $("#start_time").val('');
                $("#end_time").val('');
                $("#is_ban").val('');
                $("input[name='version_id'][value='1']").prop('checked', 'checked');
                $("#user-form").attr("action","{:url('superman/save')}");
                $("#modal-user").modal();
            }
        }

        //弹出用户信息弹出层
        function showUserinfoForm(x){
            var id = x;
            if(!id){
                layer.msg('用户参数id错误',{time:1200,shade:0.7});
                return false;
            }

            var url = "{:url('users/read')}?id="+id;
            layer.open({
                type: 2,
                title: '用户信息',
                shadeClose: true,
                shade: 0.8,
                area: ['80%','300px'],
                content: url //iframe的url
            });
        }
    </script>
</body>
</html>
